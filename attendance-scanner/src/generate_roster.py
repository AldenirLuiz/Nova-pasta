from parser import parse_attendance_data
import csv
import os

# Usa a mesma amostra do test_parser.py; ajuste se quiser usar um arquivo real
SAMPLE = """ADRIANO DANTAS íBOCA SERVENTE 11:37 17101—
ALDENIRLUIZ — — GAMBIARRA — [PEDREIRO | 635 1133 / 13:02/ 170
ANDREVIEIBA — ANDRE — o PINTOR %ÃJTÉÃ:% 13:07 | 17:09
ANTONIOMARÇOS — || ARCO — u ÍPEDREIRO 11:32 17:06
CAIORAFAEL — — RAFAEL PEDREIRO — | 6:37 |19:36 | 13:02 ) 47:01
Ç—Eglf—ªÃLDO POSSIDONIO PINTO SERVENTE 11:30 | 13:04 / 497:904
EOSME ALMEIDA | ;7 COSME B PEDREIRO 6:34 11137 | E F
DAMIAO CARLOS DA SILVA BODEROCO — ÍPEDREIRO — | G:30 | 11:33] 13:02| 17:02
emERSON LINHARES — — TxeNEM mee |687 1137 | 1502 |mo
| IFLÁVIO FIDELIS DA SILVA FLÁVIO ISERVENTE 6:31 | 11:39 | 13:00 | 17:07
FRANCISCODASCHAGAs — —— — — —— ÍNEGAO — — |FERREIRO — | 631  11:32|13:03] 1706
' [FRANCISCO ERINALDO E SILVA NALDO PEDREIRO — | 6:34 1701
| IFRANCISCO FERREIRA F. NETO ELETRICISTA 7:02 | 19:04 1 43:09 | 17:04
- [FRANCISCO LUIZ LUZ PEDREIRO 17:09
ÍFRANCISCO SILVESTRE DA SILVA FILHO — IFRANCISCO — ISERVENTE — | 6:30 | 11:39 17:05
 [GEOCI DE SOUZA. 165&(:1 FERREIRO — | 6:33 |14:87 / 13:03/17:00
ISRAELRODRIGUES — || wRaelL —  ÍeNTOR / | 637 1131 | 13:09 | 17:08
JEFERSOM ALVES JEFERSOM PINTOR ( 636 11:353 | 13:09 | 17:04
JOÃDBATÍS%—ÃDEDUVE(RA——%— JOÃO BATISTA — IPEDREIRO 8:31 13:03 170%—
JORO BEZERRA DA SILVA — JORO BEZERRA IFERRE!RO 6:32 17:03
JOAO FERNANDES DA SILVA ? lõao SERVENTE — | G:35 | 11:36/ 1301 4701
JOAQUIM IVAN DOS SANTOS — BRLÁA PEDREIRO 6:35 | 11:37 | 13:03 171052
JONLDO ESTAVAN DA SILVA: PAGÊ — — SERVENTE — | 6:37 | 49:37 / 13:07 ) 17:09
|JOSE ALEXANDRE DA SILVA é [ZEDOCAROCO SERVENTE | g:ão 13:03 | 17:02
JOSEDASILVAESOUSA — — — .. ZEDOARROCHA SERVENTE — | 6:36 |44:30 4309 | (7.08
JOSE EGNALDO FREIRE DA SILVA - IEGNALDO SERVENTE —| 632 | 11:39 | 13:06 | 17:02
JOSE MARIANO DE ME;BE;Í;OS NETO NETINHO SERVENTE 6:31 | 11:33 17:01
JOSÉ PAULINO DOS SANTOS m PÉDRE?RO 5;2 11:39 1%&_
JOSENALDO GOMES DA SILVA NENEM SERVENTE — | GE lª FE
KÇEE—EÍREQN JEFERSON GALAU PEDREIRO 8:34 | 11:36 | 13:08 | 47:01
TLARSONDELIRAARAWJO | c lALSON — SCRVENTE | G:34 |4133 / 13:06 | 17:03
LEANDRODAS.GONÇALVES — .. — |LEANDRO seRvENTE — | 6:32 | 11:34 | 13:02 | 1701
LEANDRO-SALES.GABRIEL. — OBINA SERVENTE — | 6:33 | 11:36 17:00
TLUCENILDO ... e ÍNHLDO PEDREIRO — | 6:36 | 191:30 17:08
MAICOM ImaICOM SERVENTE — | 6:37 |19:30] 13:09] 17:05
MARCOSDESOUZA ||| MARQUINHOS. 6:36 | 11:35 17:02.
MATHEUS JERONIMO D ÍMÃTHÉUS PINTOR fe 11:33 17:03
MICHAEL DE LIMA MICHEL SERVENTE 8:33 1135[ 13:08 | 17:03
PaULOROGERIO — —— .  ÍRoGERO SERVENTE — | 6:35 |19:36] 13021704
PAULOSERGIO |€ PAULO SERVENTE 6:33 H:B%( 13:07 WÉ
RAFAEL FERREWÃ;Ã—__»—— FAEL MAGAO SERVENTE _€W3'Í 13:04 | 47:02
RÃFAEL.RNMUNDO " RAFAEL ELETR!C?SÍ%Ã 7:03 íí:ãºg 17:08
RAILSON ABSOLON VARELA RAVENGAR SERVENTE 11:35 17:07
RENATO RENATO PEDREIRO — / G:30 |11:32 | 13:03] 1704
RICARDO DA SILVA RICARDO f
RE)BERTO SANTOS MEDEIROS d FÉ(Z%ÉÉTZ_ SERVENTE ; F | F F F
RONALDO RONALDO SERVENTE — | 6:30 17:00 |
SEBASTIAO PAULINO DOS SANTOS BATATA- SERVENTE — | 6:38 | 11:38 / 1301 | 47:07
TIAGO FE%!—)E— THIAGO PINTOR õ '5;38 11:32 F
WEL!NGTTOMÉ?_ÃÍÍÉS DA SILVA 5M JWELUNGTON ALMOXARIFE 633 f 119:39 | 13:01 | 17:02"""


def generate_candidates(sample: str = SAMPLE, out_path: str = None):
    res = parse_attendance_data(sample)
    candidates = {}
    for d in res['details']:
        name = d.get('corrected_name') or 'Unknown'
        candidates[name] = candidates.get(name, 0) + 1

    out = out_path or os.path.join(os.path.dirname(__file__), '..', 'roster_candidates.csv')
    with open(out, 'w', newline='', encoding='utf-8') as f:
        writer = csv.writer(f)
        writer.writerow(['candidate_name','count'])
        for name, cnt in sorted(candidates.items(), key=lambda x: -x[1]):
            writer.writerow([name, cnt])
    print(f'Roster candidates written to: {out}')


if __name__ == '__main__':
    generate_candidates()